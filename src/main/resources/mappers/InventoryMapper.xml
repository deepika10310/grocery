<?xml version = "1.0" encoding = "UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.grocery.on.wheels.dao.InventoryMapper">

	<resultMap type="com.grocery.on.wheels.model.Item" id="itemMap">
		<id property="itemId" column="itemId"/>
		<result property="domain" column="domain"/>
		<result property="inventoryId" column="inventoryId"/>
		<result property="itemName" column="itemName"/>
		<result property="itemCode" column="itemCode"/>
		<result property="itemUnit" column="itemUnit"/>
		<result property="itemUnitCount" column="itemUnitCount"/>
		<result property="itemIcon" column="itemIcon"/>
		<result property="itemQrBarCode" column="itemQrBarCode"/>
		<collection property="itemPrice" javaType="ArrayList" ofType="com.grocery.on.wheels.model.ItemPrice">
			<result property="mrp" column="mrp"/>
			<result property="cp" column="cp"/>
			<result property="sp" column="sp"/>
			<result property="itemCount" column="itemCount"/>
		</collection>
	</resultMap>

	<select id="listInventory" resultType="com.grocery.on.wheels.model.Inventory">
		select inventory_id as inventoryId, inventory_name as inventroyName from
		inventory;
	</select>

	<select id="getItems" resultMap="itemMap"
		parameterType="String">
		SELECT iim.inventory_id as inventoryId, iim.item_id as itemId,
		iim.item_count as itemCount, ii.item_name as itemName, ii.item_code as itemCode,
		ii.item_unit as itemUnit, ii.item_unit_count as itemUnitCount,
		ii.item_icon as itemIcon, ii.item_qrbar_code as itemQrBarCode,
		ipm.mrp as mrp, ipm.cp as cp, ipm.sp as sp
		FROM inventory_item_map iim
		join item_info ii on (iim.item_id = ii.item_id and iim.inventory_id = #{inventoryId})
		join item_price_map ipm on (ii.item_id = ipm.item_id and iim.mrp = ipm.mrp)
	</select>
	
	<select id="getItemsByName" resultMap="itemMap">
		SELECT iim.inventory_id as inventoryId, iim.item_id as itemId,
		iim.item_count as itemCount, ii.item_name as itemName, ii.item_code as itemCode,
		ii.item_unit as itemUnit, ii.item_unit_count as itemUnitCount,
		ii.item_icon as itemIcon, ii.item_qrbar_code as itemQrBarCode,
		ipm.mrp as mrp, ipm.cp as cp, ipm.sp as sp
		FROM inventory_item_map iim
		join item_info ii on (iim.item_id = ii.item_id and iim.inventory_id = #{inventoryId}
		and ii.item_name like #{searchText})
		join item_price_map ipm on (ii.item_id = ipm.item_id and iim.mrp = ipm.mrp)
	</select>
	
</mapper>